"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=t(require("https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js")),i=function(){function t(t){this.p5=t}return t.prototype.render=function(t){var e=this,i=t.getConstraint();this.p5.fill(0),this.p5.circle(i.x,i.y,2*i.z),t.getObjects().map((function(t){e.p5.fill(t.color.r,t.color.g,t.color.b),e.p5.circle(t.position.x,t.position.y,2*t.radius)})),this.p5.fill(255),this.p5.text("Objects:"+t.getObjects().length,5,15),this.p5.text("FPS:"+Math.floor(1e3/this.p5.deltaTime),5,25),this.p5.text("Simulations/s:"+Math.floor(1/t.getStepDt()),5,35)},t}(),o=function(){function t(t,i){this.position=t,this.position_last=t,this.acceleration=new e.default.Vector(0,0),this.radius=i||10,this.color={r:255,g:255,b:255}}return t.prototype.update=function(t){var i=e.default.Vector.sub(this.position,this.position_last);this.position_last=new e.default.Vector(this.position.x,this.position.y);var o=this.acceleration;o.mult(t*t),this.position.add(e.default.Vector.add(i,o)),this.acceleration=new e.default.Vector(0,0)},t.prototype.accelerate=function(t){this.acceleration.add(t)},t.prototype.setVelocity=function(t,i){this.position_last=e.default.Vector.sub(this.position,e.default.Vector.mult(t,i))},t}(),s=function(){function t(){this.m_sub_steps=1,this.m_gravity=new e.default.Vector(0,1e3),this.m_constraint_radius=100,this.m_constraint_center=new e.default.Vector,this.m_objects=[],this.m_time=0,this.m_frame_dt=0}return t.prototype.addObject=function(t,e){var i=new o(t,e);return this.m_objects.push(i),i},t.prototype.resetObjects=function(){this.m_objects=[]},t.prototype.update=function(){this.m_time+=this.m_frame_dt;for(var t=this.getStepDt(),e=0;e<this.m_sub_steps;e++)this.applyGravity(),this.checkCollisions(t),this.applyConstraint(),this.updateObjects(t)},t.prototype.setSimulationUpdateRate=function(t){this.m_frame_dt=1/t},t.prototype.setConstraint=function(t,e){this.m_constraint_center=t,this.m_constraint_radius=e},t.prototype.setSubStepsCount=function(t){this.m_sub_steps=t},t.prototype.setObjectVelocity=function(t,e){t.setVelocity(e,this.getStepDt())},t.prototype.getObjects=function(){return this.m_objects},t.prototype.getConstraint=function(){return new e.default.Vector(this.m_constraint_center.x,this.m_constraint_center.y,this.m_constraint_radius)},t.prototype.getObjectsCount=function(){return this.m_objects.length},t.prototype.getTime=function(){return this.m_time},t.prototype.getStepDt=function(){return this.m_frame_dt/this.m_sub_steps},t.prototype.applyGravity=function(){var t=this;this.m_objects.map((function(e){return e.accelerate(t.m_gravity)}))},t.prototype.checkCollisions=function(t){for(var i=this.m_objects.length,o=0;o<i;++o)for(var s=this.m_objects[o],n=o+1;n<i;++n){var r=this.m_objects[n],a=e.default.Vector.sub(s.position,r.position),c=a.x*a.x+a.y*a.y,u=s.radius+r.radius;if(c<u*u){var p=Math.sqrt(c),l=e.default.Vector.div(a,p),h=s.radius/(s.radius+r.radius),d=r.radius/(s.radius+r.radius),f=.375*(p-u);s.position.sub(e.default.Vector.mult(l,d*f)),r.position.add(e.default.Vector.mult(l,h*f))}}},t.prototype.applyConstraint=function(){var t=this;this.m_objects.map((function(i){var o=e.default.Vector.sub(t.m_constraint_center,i.position),s=Math.sqrt(o.x*o.x+o.y*o.y);if(s>t.m_constraint_radius-i.radius){var n=e.default.Vector.div(o,s);i.position=e.default.Vector.sub(t.m_constraint_center,e.default.Vector.mult(n,t.m_constraint_radius-i.radius))}}))},t.prototype.updateObjects=function(t){this.m_objects.map((function(e){return e.update(t)}))},t}();new e.default((function(t){var o=new s,n=new i(t),r=new e.default.Vector(500,200),a=200,c=0;t.setup=function(){var i=t.createButton("Reset");i.position(950,10),i.mouseClicked((function(){o.resetObjects()}));var s=t.createSlider(1,10,3,1);s.mouseClicked((function(){o.setSubStepsCount(s.value())})),s.position(120,30);var n=t.createSlider(1,2e3,a,1);n.mouseClicked((function(){var t=a;(a=n.value())<t&&o.resetObjects()})),n.position(120,10),t.createCanvas(1e3,1e3),o.setConstraint(new e.default.Vector(500,500),450),o.setSubStepsCount(3),o.setSimulationUpdateRate(60),t.noStroke()},t.draw=function(){var i=1e3*t.millis();if(o.getObjectsCount()<a&&i-c>=.025){c=i;var s=o.addObject(r,t.random(1,20)),u=o.getTime(),p=1*Math.sin(u)+.5*Math.PI;o.setObjectVelocity(s,new e.default.Vector(Math.cos(p),Math.sin(p)).mult(1200)),s.color=function(t){var e=Math.sin(t),i=Math.sin(t+.66*Math.PI),o=Math.sin(t+1.32*Math.PI);return{r:255*e*e,g:255*i*i,b:255*o*o}}(u)}o.update(),t.background(128),n.render(o)},t.mouseClicked=function(){}}));
